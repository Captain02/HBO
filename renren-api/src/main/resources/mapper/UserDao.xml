<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.renren.modules.login.dao.UserDao">

    <select id="userLogin" resultType="io.renren.common.entity.PageData">
        SELECT user_id,`username`,`password`,salt
        FROM sys_user
        WHERE 
        `username` = #{username}
    </select>

    <select id="getinfoByIdNotContentRoleDept" resultType="io.renren.common.entity.PageData">
        SELECT
        sys_user.user_id,sys_user.username,sys_user.college,
        sys_user.collegetie,sys_user.gender,sys_user.descs,filetable.filepath,sys_user.`name`,
        filetable.`filepath` headpath
        FROM sys_user
        LEFT JOIN filetable ON filetable.id = sys_user.fileid
        WHERE user_id = #{id}
    </select>
    <insert id="saveuserwehartinfo" useGeneratedKeys="true" keyProperty="user_id">
      insert into sys_user (`name`,`gender`,`fileid`) values (#{name},#{gender},#{fileid});
    </insert>

    <update id="updateUser">
        UPDATE sys_user
        <trim prefix="set" suffixOverrides=",">
            <if test="username != null and username != 'null'">
                `username` = #{username},
            </if>
            <if test="newpassword != null and newpassword != 'null'">
                `password` = #{newpassword},
            </if>
            <if test="salt != null and salt != 'null'">
                `salt` = #{salt},
            </if>
            <if test="email != null and email != 'null'">
                `email` = #{email},
            </if>
            <if test="mobile != null and mobile != 'null'">
                `mobile` = #{mobile},
            </if>
            <if test="username != null and username != 'null'">
                `persionnum` = #{username},
            </if>
            <if test="wechart != null and wechart != 'null'">
                `wechart` = #{wechart},
            </if>
            <if test="qq != null and qq != 'null'">
                `qq` = #{qq},
            </if>
            <if test="college != null and college != 'null'">
                `college` = #{college},
            </if>
            <if test="collegetie != null and collegetie != 'null'">
                `collegetie` = #{collegetie},
            </if>
            <if test="descs != null and descs != 'null'">
                `descs` = #{descs},
            </if>
            <if test="name != null and name != 'null'">
                `name` = #{name},
            </if>
            <if test="fileid != null and fileid != 'null'">
                `fileid` = #{fileid},
            </if>
        </trim>
        WHERE user_id = #{user_id}
    </update>

    <select id="selectUserByusername" resultType="Long">
        SELECT COUNT(*) num
        FROM sys_user
        WHERE sys_user.`username` = #{username}
    </select>

    <select id="selectUserInfoByusername" resultType="io.renren.common.entity.PageData">
        SELECT
        sys_user.user_id,sys_user.username,sys_user.college,
        sys_user.collegetie,sys_user.gender,sys_user.descs,filetable.filepath,sys_user.`name`,
        sys_user.`qq`,sys_user.`email`,sys_user.`mobile`,sys_user.`wechart`,
        filetable.`filepath` headpath
        FROM sys_user
        LEFT JOIN filetable ON filetable.id = sys_user.fileid
        WHERE sys_user.username = #{username}
    </select>

    <insert id="add" useGeneratedKeys="true" keyProperty="user_id">
        INSERT INTO `sys_user` (`username`,`password`,`salt`,`mobile`,`persionnum`,
	        `gender`,`name`,`fileid`)
        VALUES (#{username},#{password},#{salt},#{mobile},#{username},#{gender},#{name},#{fileid})
    </insert>

</mapper>