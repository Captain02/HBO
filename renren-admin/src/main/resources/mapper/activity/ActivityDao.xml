<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ActivityDao">

    <resultMap id="activityPageData" type="io.renren.common.entity.PageData">
        <collection property="pd.states" javaType="ArrayList" ofType="pd.states" column="states" select="selectActprocessForActivity">
        </collection>
    </resultMap>

    <select id="activitylistPage" resultMap="activityPageData">
        select c.`actname`,c.`actstarttame`,c.`actendtime`,c.`createtime`,c.`crowdpeople`,
            c1.`corname`,f.`filepath`,a.`states`,a.`processnode`,a.`proid`,
            count(distinct l.`userid`) likeCount,
            count(DISTINCT c2.`userid`) collectionCount
        from `coractivity` c
        left join `corporation` c1 on c1.`id` = c.`actcorid`
        left join `sys_user` u on u.`user_id` = c.`actleading`
        left join `filetable` f on f.`id` = u.`fileid`
        left join `bbs_like` l on l.`topicid` = c.`actid`
        left join `bbs_collection` c2 on c2.`topicid` = c.`actcorid`
        LEFT JOIN `actprocess` a ON c.`actid` = a.`actid`
        WHERE c1.`id`=#{pd.corId,jdbcType=INTEGER}
        group by c.`actid`,a.`states`,a.`processnode`,a.`proid`
        order by a.`proid`
    </select>

    <select id="selectActprocessForActivity" resultType="io.renren.common.entity.PageData">
        SELECT * FROM `actprocess` WHERE actid = #{pd.actId,jdbcType=INTEGER} ORDER BY `proid`
    </select>
</mapper>