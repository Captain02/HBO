<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ResumeDao">
    <select id="resumelistPage" resultType="io.renren.common.entity.PageData">
        SELECT u.`user_id`,u.`name`,u.`email`,u.`gender`,u.`persionnum`,u.`mobile`,u.`status`,u.`college`,
        u.`collegetie`,u.`QQ`,u.`wechart`,u.`create_time`,u.`username`,
        f1.`filepath`
        FROM sys_user u
        LEFT JOIN `filetable` f1 ON f1.`id`=u.`fileid`
        LEFT JOIN `cor_user` cu ON u.`user_id`=cu.`userid`
        LEFT JOIN `corporation` c ON c.`id`=cu.`corid`
        <where>
            c.`id`=#{pd.corId,jdbcType=INTEGER}
            <if test="pd.name != null">
                AND u.`name` LIKE CONCAT('%',#{pd.name,jdbcType=VARCHAR},'%')
            </if>
            <if test="pd.persionNum != null">
                AND u.`persionnum` LIKE CONCAT('%',#{pd.persionNum,jdbcType=VARCHAR},'%')
            </if>
            <if test="pd.status == 0">
                AND u.`status` != 0
            </if>
            <if test="pd.status != null and pd.status != 0">
                AND u.`status` = #{pd.status,jdbcType=INTEGER}
            </if>
        </where>
    </select>

    <select id="info" resultType="io.renren.common.entity.PageData">
        select  u.`user_id`,u.`username`,u.`email`,u.`mobile`,u.`status`,u.`create_time`,u.`persionnum`,
                u.`wechart`,u.`QQ`,u.`college`,u.`collegetie`,u.`gender`,
                u.`descs`,u.`name`,f1.`filepath`
        from `sys_user` u
        LEFT JOIN `filetable` f1 ON f1.`id`=u.`fileid`
        where u.`user_id`=#{resumeId,jdbcType=INTEGER}
    </select>

    <select id="selectCount" resultType="io.renren.common.entity.PageData">
        select count(u.`user_id`) num,c.`id` corId
        from sys_user u,`cor_user` cu, `corporation` c
        where u.`user_id`=cu.`userid`
        AND c.`id`=cu.`corid`
        AND c.`id`=#{corId,jdbcType=INTEGER}
        <if test="statu == null">
            AND u.`status` != 0
        </if>
        <if test="statu != null">
            AND u.`status` = #{statu,jdbcType=INTEGER}
        </if>
    </select>

    <select id="selectAll" resultType="io.renren.common.entity.PageData">
        SELECT u.`name` ,u.`collegetie`,u.`gender`,u.`persionnum`,u.`mobile`, u.`college`,u.`wechart`,u.`QQ`,u.`status`
        FROM sys_user u,`cor_user` cu, `corporation` c
        WHERE u.`user_id`=cu.`userid`
        AND c.`id`=cu.`corid`
        AND u.`status`!=0
        AND c.`id`=#{corId,jdbcType=INTEGER}
    </select>

    <select id="chart" resultType="io.renren.common.entity.PageData">
        CALL `chart_count`(#{corId,jdbcType=INTEGER},#{statu,jdbcType=INTEGER},#{column,jdbcType=INTEGER});
    </select>

    <update id="update">
        update `sys_user` set `status` = #{status,jdbcType=INTEGER} where `user_id` = #{resumeId,jdbcType=INTEGER}
    </update>

</mapper>