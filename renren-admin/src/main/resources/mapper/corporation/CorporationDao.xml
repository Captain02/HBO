<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CorporationDao">

    <sql id="corSql">
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="corName!=null and corName!=''">
                #{corName,jdbcType=VARCHAR},
            </if>
            <if test="corleading!=null">
                #{corleading,jdbcType=INTEGER},
            </if>
            <if test="corTercher!=null and corTercher!=''">
                #{corTercher,jdbcType=VARCHAR},
            </if>
            <if test="corWorkspace!=null and corWorkspace!=''">
                #{corWorkspace,jdbcType=VARCHAR},
            </if>
            <if test="corCollege!=null">
                #{corCollege,jdbcType=INTEGER},
            </if>
            <if test="corFaculty!=null">
                #{corFaculty,jdbcType=INTEGER},
            </if>
            <if test="corScale!=null">
                #{corScale,jdbcType=INTEGER},
            </if>
            <if test="fileId!=null">
                #{fileId,jdbcType=INTEGER},
            </if>
            <if test="descs!=null and descs!=''">
                #{descs,jdbcType=VARCHAR},
            </if>
            <if test="videoId!=null">
                #{videoId,jdbcType=INTEGER},
            </if>
            <if test="bannerId!=null">
                #{bannerId,jdbcType=INTEGER},
            </if>
            <if test="isCor!=null">
                #{isCor,jdbcType=INTEGER},
            </if>
            <if test="deptId!=null">
                #{deptId,jdbcType=INTEGER},
            </if>
            <if test="corId!=null">
                #{corId,jdbcType=INTEGER},
            </if>
        </trim>
    </sql>

    <select id="corporationlistPage" resultType="io.renren.common.entity.PageData">
        SELECT cor.`id`,`corname`,`corleading`,cor.`createtime`,cor.`corscale`,`descs`,
            f1.`filepath` bannerfile,
            f2.`filepath` videofile
        FROM `corporation` cor
        LEFT JOIN  filetable f1 ON f1.`id` = cor.`bannerid`
        LEFT JOIN filetable f2 ON f2.`id` = cor.`videofile`
        WHERE cor.`iscor` = 1
    </select>

    <select id="selectByCorId" resultType="io.renren.common.entity.PageData">
        SELECT cor.`id`,`corname`,`corleading`,`cortercher`,`corworkspace`,cor.`createtime`,cor.`descs`,cor.corscale,
                corcollege,
                sd2.`value` corcollegename,
                sd3.`value` corfaculty,
                f1.`filepath` filefile,
                f2.`filepath` bannerfile,
                f3.`filepath` videofile,
                su.`username` leadusername,
                su.`name` leadingname
        FROM `corporation` cor
        LEFT JOIN `sys_dict` sd2 ON sd2.`id` = cor.`corcollege`
        LEFT JOIN `sys_dict` sd3 ON sd3.`id` = cor.`corfaculty`
        LEFT JOIN `filetable` f1 ON f1.`id` = cor.`fileid`
        LEFT JOIN  filetable f2 ON f2.`id` = cor.`bannerid`
        LEFT JOIN filetable f3 ON f3.`id` = cor.`videofile`
        LEFT JOIN sys_user su ON su.user_id = cor.corleading
        WHERE cor.`id`=#{corid} AND cor.`iscor` = 1
    </select>

    <insert id="add" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `corporation`
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="corName!=null and corName!=''">
                `corname`,
            </if>
            <if test="corleading!=null">
                `corleading`,
            </if>
            <if test="corTercher!=null and corTercher!=''">
                `cortercher`,
            </if>
            <if test="corWorkspace!=null and corWorkspace!=''">
                `corworkspace`,
            </if>
            <if test="corCollege!=null">
                `corcollege`,
            </if>
            <if test="corFaculty!=null">
                `corfaculty`,
            </if>
            <if test="corScale!=null">
                `corscale`,
            </if>
            <if test="fileId!=null">
                `fileid`,
            </if>
            <if test="descs!=null and descs!=''">
                `descs`,
            </if>
            <if test="videoId!=null">
                `videofile`,
            </if>
            <if test="bannerId!=null">
                `bannerid`,
            </if>
            <if test="isCor!=null">
                `iscor`,
            </if>
            <if test="deptId!=null">
                `deptid`,
            </if>
            <if test="corId!=null">
                `corid`,
            </if>
        </trim>
        VALUES
        <include refid="corSql"/>
    </insert>

    <insert id="addCorUser" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `cor_user`(`userid`,`corid`,`status`)
        VALUES(#{userId,jdbcType=INTEGER},#{id,jdbcType=INTEGER},1)
    </insert>

    <update id="update">
        UPDATE corporation set iscor = 0 WHERE id = #{id}
    </update>

    <update id="updateCor">
        UPDATE corporation
        <set>
            <if test="corName!=null and corName!=''">
                `corname`=#{corName,jdbcType=VARCHAR},
            </if>
            <if test="corleading!=null">
                `corleading`=#{corleading,jdbcType=INTEGER},
            </if>
            <if test="corTercher!=null and corTercher!=''">
                `cortercher`=#{corTercher,jdbcType=VARCHAR},
            </if>
            <if test="corWorkspace!=null and corWorkspace!=''">
                `corworkspace`=#{corWorkspace,jdbcType=VARCHAR},
            </if>
            <if test="corCollege!=null">
                `corcollege`=#{corCollege,jdbcType=INTEGER},
            </if>
            <if test="corscale!=null">
                `corscale`=#{corscale,jdbcType=INTEGER},
            </if>
            <if test="fileId!=null">
                `fileid`=#{fileId,jdbcType=INTEGER},
            </if>
            <if test="descs!=null and descs!=''">
                `descs`=#{descs,jdbcType=VARCHAR},
            </if>
            <if test="videoId!=null">
                `videofile`=#{videoId,jdbcType=INTEGER},
            </if>
            <if test="bannerId!=null">
                `bannerid`=#{bannerId,jdbcType=INTEGER},
            </if>
            <if test="isCor!=null">
                `iscor`=#{isCor,jdbcType=INTEGER},
            </if>
            <if test="deptId!=null">
                `deptid`=#{deptId,jdbcType=INTEGER},
            </if>
            <if test="corId!=null">
                `corid`=#{corId,jdbcType=INTEGER},
            </if>
        </set>
        WHERE id = #{corid}
    </update>

</mapper>